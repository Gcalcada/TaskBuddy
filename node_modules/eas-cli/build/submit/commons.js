"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.resolveArchiveSource = void 0;
const ArchiveSource_1 = require("./ArchiveSource");
function resolveArchiveSource(ctx, platform) {
    const { url, path, id, latest } = ctx.archiveFlags;
    const chosenOptions = [url, path, id, latest];
    if (chosenOptions.filter(opt => opt).length > 1) {
        throw new Error(`Pass only one of: --url, --path, --id, --latest`);
    }
    if (url) {
        return {
            sourceType: ArchiveSource_1.ArchiveSourceType.url,
            url,
            platform,
            projectId: ctx.projectId,
            nonInteractive: ctx.nonInteractive,
        };
    }
    else if (path) {
        return {
            sourceType: ArchiveSource_1.ArchiveSourceType.path,
            path,
            platform,
            projectId: ctx.projectId,
            nonInteractive: ctx.nonInteractive,
        };
    }
    else if (id) {
        if (!(0, ArchiveSource_1.isUuidV4)(id)) {
            throw new Error(`${id} is not a valid ID`);
        }
        return {
            sourceType: ArchiveSource_1.ArchiveSourceType.buildId,
            id,
            platform,
            projectId: ctx.projectId,
            nonInteractive: ctx.nonInteractive,
        };
    }
    else if (latest) {
        return {
            sourceType: ArchiveSource_1.ArchiveSourceType.latest,
            platform,
            projectId: ctx.projectId,
            nonInteractive: ctx.nonInteractive,
        };
    }
    else if (ctx.nonInteractive) {
        throw new Error('You need to specify the archive source when running in non-interactive mode ');
    }
    else {
        return {
            sourceType: ArchiveSource_1.ArchiveSourceType.prompt,
            platform,
            projectId: ctx.projectId,
            nonInteractive: ctx.nonInteractive,
        };
    }
}
exports.resolveArchiveSource = resolveArchiveSource;
