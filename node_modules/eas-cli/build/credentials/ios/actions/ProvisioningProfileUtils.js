"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateProvisioningProfileAsync = exports.formatProvisioningProfileFromApple = void 0;
const tslib_1 = require("tslib");
const chalk_1 = tslib_1.__importDefault(require("chalk"));
function formatProvisioningProfileFromApple(appleInfo) {
    var _a;
    const { expires, provisioningProfileId } = appleInfo;
    const id = provisioningProfileId !== null && provisioningProfileId !== void 0 ? provisioningProfileId : '-----';
    const name = (_a = appleInfo.name) !== null && _a !== void 0 ? _a : '-----';
    const expiryString = expires ? new Date(expires * 1000).toDateString() : 'unknown';
    const details = chalk_1.default.green(`\n    Name: ${name}\n    Expiry: ${expiryString}`);
    return `Provisioning Profile - ID: ${id}${details}`;
}
exports.formatProvisioningProfileFromApple = formatProvisioningProfileFromApple;
async function generateProvisioningProfileAsync(ctx, bundleIdentifier, distCert) {
    const appleAuthCtx = await ctx.appStore.ensureAuthenticatedAsync();
    const type = appleAuthCtx.team.inHouse ? 'Enterprise ' : 'AppStore';
    const profileName = `*[expo] ${bundleIdentifier} ${type} ${new Date().toISOString()}`; // Apple drops [ if its the first char (!!)
    return await ctx.appStore.createProvisioningProfileAsync(bundleIdentifier, distCert, profileName);
}
exports.generateProvisioningProfileAsync = generateProvisioningProfileAsync;
