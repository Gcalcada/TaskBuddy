"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.resolveWorkflowAsync = void 0;
const tslib_1 = require("tslib");
const config_plugins_1 = require("@expo/config-plugins");
const eas_build_job_1 = require("@expo/eas-build-job");
const fs_extra_1 = tslib_1.__importDefault(require("fs-extra"));
const path_1 = tslib_1.__importDefault(require("path"));
const vcs_1 = require("../vcs");
async function resolveWorkflowAsync(projectDir, platform) {
    let platformWorkflowMarker;
    try {
        platformWorkflowMarker =
            platform === eas_build_job_1.Platform.ANDROID
                ? await config_plugins_1.AndroidConfig.Paths.getAndroidManifestAsync(projectDir)
                : config_plugins_1.IOSConfig.Paths.getPBXProjectPath(projectDir);
    }
    catch {
        return eas_build_job_1.Workflow.MANAGED;
    }
    if (await fs_extra_1.default.pathExists(platformWorkflowMarker)) {
        return (await (0, vcs_1.getVcsClient)().isFileIgnoredAsync(path_1.default.relative(projectDir, platformWorkflowMarker)))
            ? eas_build_job_1.Workflow.MANAGED
            : eas_build_job_1.Workflow.GENERIC;
    }
    else {
        return eas_build_job_1.Workflow.MANAGED;
    }
}
exports.resolveWorkflowAsync = resolveWorkflowAsync;
