"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.gitDiffAsync = exports.getGitDiffOutputAsync = exports.gitStatusAsync = exports.doesGitRepoExistAsync = exports.isGitInstalledAsync = void 0;
const tslib_1 = require("tslib");
const spawn_async_1 = tslib_1.__importDefault(require("@expo/spawn-async"));
async function isGitInstalledAsync() {
    try {
        await (0, spawn_async_1.default)('git', ['--help']);
    }
    catch (error) {
        if (error.code === 'ENOENT') {
            return false;
        }
        throw error;
    }
    return true;
}
exports.isGitInstalledAsync = isGitInstalledAsync;
async function doesGitRepoExistAsync() {
    try {
        await (0, spawn_async_1.default)('git', ['rev-parse', '--git-dir']);
        return true;
    }
    catch {
        return false;
    }
}
exports.doesGitRepoExistAsync = doesGitRepoExistAsync;
async function gitStatusAsync({ showUntracked } = {}) {
    return (await (0, spawn_async_1.default)('git', ['status', '-s', showUntracked ? '-uall' : '-uno'])).stdout;
}
exports.gitStatusAsync = gitStatusAsync;
async function getGitDiffOutputAsync() {
    return (await (0, spawn_async_1.default)('git', ['--no-pager', 'diff'])).stdout;
}
exports.getGitDiffOutputAsync = getGitDiffOutputAsync;
async function gitDiffAsync({ withPager = false, } = {}) {
    const options = withPager ? [] : ['--no-pager'];
    await (0, spawn_async_1.default)('git', [...options, 'diff'], { stdio: ['ignore', 'inherit', 'inherit'] });
}
exports.gitDiffAsync = gitDiffAsync;
