"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const config_1 = require("@expo/config");
const graphql_tag_1 = tslib_1.__importDefault(require("graphql-tag"));
const EasCommand_1 = tslib_1.__importDefault(require("../../commandUtils/EasCommand"));
const client_1 = require("../../graphql/client");
const log_1 = tslib_1.__importDefault(require("../../log"));
const projectUtils_1 = require("../../project/projectUtils");
const formatFields_1 = tslib_1.__importDefault(require("../../utils/formatFields"));
async function projectInfoByIdAsync(appId) {
    const data = await (0, client_1.withErrorHandlingAsync)(client_1.graphqlClient
        .query((0, graphql_tag_1.default) `
          query AppInfo($appId: String!) {
            app {
              byId(appId: $appId) {
                id
                fullName
              }
            }
          }
        `, { appId }, { additionalTypenames: ['App'] })
        .toPromise());
    return data;
}
class ProjectInfo extends EasCommand_1.default {
    async runAsync() {
        const projectDir = await (0, projectUtils_1.findProjectRootAsync)();
        const { exp } = (0, config_1.getConfig)(projectDir, { skipSDKVersionRequirement: true });
        const projectId = await (0, projectUtils_1.getProjectIdAsync)(exp);
        const { app } = await projectInfoByIdAsync(projectId);
        if (!app) {
            throw new Error(`Could not find project with ID: ${projectId}`);
        }
        log_1.default.addNewLineIfNone();
        log_1.default.log((0, formatFields_1.default)([
            { label: 'fullName', value: app.byId.fullName },
            { label: 'ID', value: projectId },
        ]));
    }
}
exports.default = ProjectInfo;
ProjectInfo.description = 'information about the current project';
